<p-toast />

<!-- Toolbar -->
<p-toolbar styleClass="mb-2">
    <ng-template #start>
        <div class="font-semibold mr-5" style="font-size:1.5rem">Grading Participants</div>
    </ng-template>
</p-toolbar>
<div class="card">
    <p-tabs value="0" (valueChange)="onTabChange($event)">
        <p-tablist>
            <p-tab *ngFor="let skill of proctorSkillCategories" [value]="skill.value"
                [ngStyle]="{'color': skill.color}">{{
                skill.label }}</p-tab>
        </p-tablist>
        <p-tabpanels>
            <p-tabpanel *ngFor="let skill of proctorSkillCategories" [value]="skill.value">
                <p-toolbar styleClass="mb-2">
                    <!-- Search By MIS Id -->
                    <ng-template #start>
                        <div class="font-semibold whitespace-nowrap mr-3" style="font-size:1rem">Search Participant for
                            <span [ngStyle]="{'color': skill.color}" class="whitespace-nowrap">{{skill.value}}</span>
                        </div>

                        <p-inputgroup>
                            <p-inputgroup-addon>
                                <i class=" fa-solid fa-hashtag"></i>
                            </p-inputgroup-addon>
                            <p-inputnumber id="candidateMISId" mode="decimal" [(ngModel)]="participantMISId"
                                [useGrouping]="false" placeholder="MIS Id" required autofocus fluid />
                            <p-inputgroup-addon>
                                <p-button icon="pi pi-search" (onClick)="searchParticipant(skill.value)" />
                            </p-inputgroup-addon>
                        </p-inputgroup>
                    </ng-template>
                </p-toolbar>
            </p-tabpanel>

            <!-- Error message -->
            <p-message severity="secondary" *ngIf="participantMISId && searchError" size="large">
                MIS Id: {{participantMISId}} <br>
                Skill: <span [style]="{'color': selectedSkillCategoryColor}">{{selectedSkillCategory}}</span> <br><br>
                <span style="color:red">{{searchError}}</span>

            </p-message>

            <div class="flex flex-col md:flex-row" *ngIf="participant && participant.misId">
                <!-- Participant Details -->
                <p-card class="card flex flex-col md:w-1/3" header="Participant Details"
                    [style]="{border: '0.1rem solid silver'}">

                    <!-- Region -->
                    <div class="grid grid-cols-12 gap-2 mt-5 mb-2">
                        <label class="flex font-bold items-center col-span-4">Region</label>
                        <div class="col-span-8">
                            <input pInputText type="text" id="fullName" [(ngModel)]="participant.region"
                                [readonly]="true" fluid />
                        </div>
                    </div>

                    <!-- Center -->
                    <div class="grid grid-cols-12 gap-2 mb-1">
                        <label class="flex font-bold items-center col-span-4">Center</label>
                        <div class="col-span-8">
                            <input pInputText type="text" id="center" [(ngModel)]="participant.center" [readonly]="true"
                                fluid />
                        </div>
                    </div>

                    <!-- MIS ID -->
                    <div class="grid grid-cols-12 gap-2 mb-1">
                        <label class="flex font-bold items-center col-span-4">MIS Id</label>
                        <div class="col-span-8">
                            <input pInputText type="text" [(ngModel)]="participant.misId" [readonly]="true" fluid />
                        </div>
                    </div>

                    <!-- BAPS ID -->
                    <div class="grid grid-cols-12 gap-2 mb-1">
                        <label class="flex font-bold items-center col-span-4">BAPS Id</label>
                        <div class="col-span-8">
                            <input pInputText type="text" [(ngModel)]="participant.bapsId" [readonly]="true" fluid />
                        </div>
                    </div>

                    <!-- Full Name -->
                    <div class="grid grid-cols-12 gap-2 mb-1">
                        <label class="flex font-bold items-center col-span-4">Full Name</label>
                        <div class="col-span-8">
                            <input pInputText type="text" id="fullName" [(ngModel)]="participant.fullName"
                                [readonly]="true" fluid />
                        </div>
                    </div>

                    <!-- Gender -->
                    <div class="grid grid-cols-12 gap-2 mb-1">
                        <label class="flex font-bold items-center col-span-4">Gender</label>
                        <div class="col-span-8">
                            <input pInputText type="text" [(ngModel)]="participant.gender" [readonly]="true" fluid />
                        </div>
                    </div>

                    <!-- Mandal -->
                    <div class="grid grid-cols-12 gap-2 mb-1">
                        <label class="flex font-bold items-center col-span-4">Mandal</label>
                        <div class="col-span-8">
                            <input pInputText type="text" [(ngModel)]="participant.mandal" [readonly]="true" fluid />
                        </div>
                    </div>

                    <!-- Emcee Category -->
                    <div class="grid grid-cols-12 gap-2 mb-1">
                        <label class="flex font-bold items-center col-span-4">Emcee</label>
                        <div class="col-span-8">
                            <input pInputText type="text" [(ngModel)]="participant.emcee_Category" [readOnly]="true"
                                fluid />
                        </div>
                    </div>

                    <!-- Speech Pravachan Category -->
                    <div class="grid grid-cols-12 gap-2 mb-1">
                        <label class="flex font-bold items-center col-span-4">Pravachan</label>
                        <div class="col-span-8">
                            <input pInputText type="text" [(ngModel)]="participant.speech_Pravachan_Category"
                                [readOnly]="true" fluid />
                        </div>
                    </div>
                </p-card>

                <!-- Participant Grading Topics -->
                <p-card class="card flex flex-col md:w-1/2" [style]="{border: '0.1rem solid silver'}">
                    <ng-template #title>
                        {{participant.fullName}} Grades for <span
                            [style]="{'color': selectedSkillCategoryColor}">{{selectedSkillCategory}}</span>
                    </ng-template>
                    <br>
                    <p-table [value]="participantGrades()" *ngIf="gradingTopics().length>0" showGridlines
                        [rowHover]="true" [scrollable]="true">
                        <!-- Grading Topics List View Header -->
                        <ng-template #header>
                            <tr>
                                <th class="whitespace-nowrap">
                                    Topic Name
                                </th>
                                <th class="whitespace-nowrap">
                                    Score
                                </th>
                            </tr>
                        </ng-template>

                        <!-- Grading Topics List View Data -->
                        <ng-template #body let-item>
                            <tr [style]="{'color': item.color}">
                                <td class="whitespace-nowrap align-top">{{ item.name }}</td>
                                <td class="whitespace-nowrap align-top"> {{ item.score }} </td>
                            </tr>
                        </ng-template>
                    </p-table>
                    <br>
                    <p-button pRipple severity="warn" [raised]="true" (onClick)="startGrading()">
                        <WindowMaximizeIcon pButtonIcon />
                        <span pButtonLabel style="font-size: large;">
                            <b>Start Grading {{participant!.fullName}} for {{selectedSkillCategory}}</b>
                        </span>
                    </p-button>
                </p-card>
            </div>

        </p-tabpanels>
    </p-tabs>
</div>

<p-dialog [(visible)]="dialog" [style]="{ width: '80%', height: 'auto' }"
    header="Grading {{participant?.fullName}} for {{selectedSkillCategory}}" [modal]="true">
    <p-table [value]="gradingTopics()" showGridlines [rowHover]="true" [scrollable]="true">
        <!-- Grading Topics List View Header -->
        <ng-template #header>
            <tr>
                <th class="whitespace-nowrap">
                    Topic Name
                </th>
                <th class="whitespace-nowrap">
                    Weightage Options
                </th>
            </tr>
        </ng-template>

        <!-- Grading Topics List View Data -->
        <ng-template #body let-item>
            <tr [style]="{'color': item.color}">
                <td class="whitespace-nowrap align-top">{{ item.name }}</td>
                <td class="whitespace-nowrap align-top">
                    <span class="mb-2" *ngFor="let weightage of item.weightageOptions"> {{weightage}}
                        &nbsp; </span>
                </td>
            </tr>
        </ng-template>
    </p-table>
</p-dialog>